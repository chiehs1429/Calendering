<!DOCTYPE html>Â 
<html lang="zh-TW">Â 
<head>Â 
Â  Â  <meta charset="UTF-8">Â 
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">Â 
Â  Â  <title>CL / CT _ Inventory (Hardcoded URLs)</title>Â 
Â  Â  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>Â 
Â  Â  <script src='https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'></script>Â 
Â 
Â  Â  <style>Â 
Â  Â  Â  Â  /* å…¨åŸŸè¨­å®š */Â 
Â  Â  Â  Â  * { box-sizing: border-box; }Â 
Â  Â  Â  Â  body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 10px; background-color: #222; color: #fff; }Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  h2 { text-align: center; margin-bottom: 10px; font-size: 2.1rem; color: #eee; font-weight: bold; letter-spacing: 1px; }Â 
Â 
Â  Â  Â  Â  /* äººå“¡ä»£è™Ÿè¼¸å…¥å€ */Â 
Â  Â  Â  Â  .user-bar {Â 
Â  Â  Â  Â  Â  Â  display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin-bottom: 10px;Â 
Â  Â  Â  Â  Â  Â  background: #2c3e50; padding: 10px 15px; border-radius: 8px; border: 2px solid #007bff; width: 100%;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  .user-bar label { font-weight: bold; color: #5dade2; white-space: nowrap; font-size: 1rem; }Â 
Â  Â  Â  Â  .input-field {Â 
Â  Â  Â  Â  Â  Â  flex: 1; min-width: 100px; padding: 8px; border: 1px solid #555; border-radius: 4px;Â 
Â  Â  Â  Â  Â  Â  background: #fff; color: #000; font-size: 1.1rem; letter-spacing: 1px; font-weight: bold;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  /* æ¨¡å¼åˆ‡æ›æŒ‰éˆ• */Â 
Â  Â  Â  Â  .mode-switch { display: flex; gap: 8px; margin-bottom: 10px; }Â 
Â  Â  Â  Â  .mode-btn {Â Â 
Â  Â  Â  Â  Â  Â  flex: 1; padding: 8px; border: none; border-radius: 20px;Â Â 
Â  Â  Â  Â  Â  Â  background: #333; color: #aaa; font-weight: bold; cursor: pointer; transition: 0.3s;Â Â 
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; align-items: center; line-height: 1.2; font-size: 0.9rem;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  .mode-btn small { font-size: 0.7rem; font-weight: normal; opacity: 0.8; }Â 
Â  Â  Â  Â  .mode-btn.active { background: #007bff; color: white; box-shadow: 0 0 10px rgba(0,123,255,0.5); }Â 
Â 
Â  Â  Â  Â  /* è¦–çª—å€åŸŸ */Â 
Â  Â  Â  Â  .viewport {Â Â 
Â  Â  Â  Â  Â  Â  position: relative;Â Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â Â 
Â  Â  Â  Â  Â  Â  height: 50vh;Â Â 
Â  Â  Â  Â  Â  Â  background: black;Â Â 
Â  Â  Â  Â  Â  Â  border-radius: 10px;Â Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;Â Â 
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;Â 
Â  Â  Â  Â  Â  Â  border: 1px solid #444;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  -webkit-tap-highlight-color: transparent;Â 
Â  Â  Â  Â  Â  Â  z-index: 1;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  #reader, #ocr-video { width: 100%; height: 100%; object-fit: cover; }Â 
Â  Â  Â  Â  #ocr-video { display: none; }Â 
Â 
Â  Â  Â  Â  .scan-guide-overlay {Â 
Â  Â  Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;Â 
Â  Â  Â  Â  Â  Â  pointer-events: none; display: none; z-index: 10;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  .guide-box {Â 
Â  Â  Â  Â  Â  Â  position: absolute; top: 50%; left: 50%;Â 
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);Â 
Â  Â  Â  Â  Â  Â  width: 96%;Â Â 
Â  Â  Â  Â  Â  Â  height: 50px;Â 
Â  Â  Â  Â  Â  Â  border: 2px solid #ff4d4d;Â Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);Â 
Â  Â  Â  Â  Â  Â  border-radius: 4px;Â 
Â  Â  Â  Â  Â  Â  transition: 0.3s all;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  .guide-box.ready { border-color: #00ff00; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.8); }Â 
Â  Â  Â  Â  .guide-box.paused { border-color: #007bff; box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.6); }Â 
Â 
Â  Â  Â  Â  .guide-line {Â 
Â  Â  Â  Â  Â  Â  position: absolute;Â 
Â  Â  Â  Â  Â  Â  top: 50%;Â 
Â  Â  Â  Â  Â  Â  left: 50%;Â 
Â  Â  Â  Â  Â  Â  width: 280px;Â Â 
Â  Â  Â  Â  Â  Â  max-width: 90%;Â 
Â  Â  Â  Â  Â  Â  height: 30px;Â Â 
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 77, 77, 0.3);Â Â 
Â  Â  Â  Â  Â  Â  transform: translate(-50%, -50%);Â 
Â  Â  Â  Â  Â  Â  pointer-events: none;Â 
Â  Â  Â  Â  Â  Â  transition: 0.3s all;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 2px rgba(255,0,0,0.5);Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  .guide-box.ready .guide-line { background-color: rgba(0, 255, 0, 0.3); }Â 
Â  Â  Â  Â  .guide-box.paused .guide-line { background-color: rgba(0, 123, 255, 0.3); }Â 
Â 
Â  Â  Â  Â  .guide-text {Â 
Â  Â  Â  Â  Â  Â  position: absolute; top: -45px; left: 0; width: 100%;Â 
Â  Â  Â  Â  Â  Â  text-align: center; color: #ff4d4d; font-size: 0.9rem; font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  text-shadow: 1px 1px 2px black;Â 
Â  Â  Â  Â  Â  Â  transition: 0.3s all;Â 
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.6);Â 
Â  Â  Â  Â  Â  Â  padding: 4px 0;Â 
Â  Â  Â  Â  Â  Â  border-radius: 4px;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  .guide-box.ready .guide-text { color: #00ff00; content: "âœ… Ready"; }Â 
Â  Â  Â  Â  .guide-box.paused .guide-text { color: #007bff; }Â 
Â 
Â  Â  Â  Â  /* æŒ‰éˆ• */Â 
Â  Â  Â  Â  .controls { display: flex; gap: 8px; padding: 5px 0; justify-content: space-between; margin-bottom: 10px; flex-wrap: wrap;}Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  button.action-btn {Â Â 
Â  Â  Â  Â  Â  Â  padding: 8px 5px; border: none; border-radius: 8px; cursor: pointer;Â Â 
Â  Â  Â  Â  Â  Â  font-weight: bold; font-size: 0.9rem; color: white; transition: 0.2s;Â 
Â  Â  Â  Â  Â  Â  display: flex; flex-direction: column; justify-content: center; align-items: center;Â 
Â  Â  Â  Â  Â  Â  line-height: 1.2;Â 
Â  Â  Â  Â  Â  Â  position: relative;Â 
Â  Â  Â  Â  Â  Â  z-index: 100;Â 
Â  Â  Â  Â  Â  Â  flex: 1;Â 
Â  Â  Â  Â  Â  Â  min-width: 60px;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  button.action-btn small { font-size: 0.7rem; font-weight: normal; opacity: 0.9; margin-top: 2px; }Â 
Â 
Â  Â  Â  Â  .btn-clear { background-color: #6c757d; }Â Â 
Â  Â  Â  Â  .btn-flash { background-color: #ffc107; color: #333 !important; }Â 
Â  Â  Â  Â  .btn-export { background-color: #28a745; }Â 
Â  Â  Â  Â  .btn-settings { background-color: #17a2b8; }Â 
Â  Â  Â  Â  .btn-upload { background-color: #007bff; }Â 
Â  Â  Â  Â  .btn-sheet { background-color: #6610f2; }Â Â 
Â 
Â  Â  Â  Â  #loading-overlay {Â 
Â  Â  Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;Â 
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.85); display: none;Â 
Â  Â  Â  Â  Â  Â  justify-content: center; align-items: center; flex-direction: column; z-index: 20;Â 
Â  Â  Â  Â  }Â 
Â  Â  Â  Â  .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #dc3545; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px;}Â 
Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }Â 
Â 
Â  Â  Â  Â  /* è¡¨æ ¼æ¨£å¼ */Â 
Â  Â  Â  Â  .table-container { margin-top: 0; overflow-x: auto; background: #fff; border-radius: 8px; color: #333; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }Â 
Â  Â  Â  Â  table { width: 100%; border-collapse: collapse; min-width: 100%; }Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  th, td { padding: 10px 6px; text-align: left; border-bottom: 1px solid #eee; font-size: 0.85rem; vertical-align: middle; }Â 
Â  Â  Â  Â  th { background-color: #333; color: white; white-space: nowrap; font-weight: bold; }Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  .code-col { width: 30%; word-break: break-all; }Â Â 
Â  Â  Â  Â  .loc-col { width: 15%; text-align: center; }Â  Â  Â  Â 
Â  Â  Â  Â  .name-col { width: 20%; }Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  th.qty-col, td.qty-col {Â Â 
Â  Â  Â  Â  Â  Â  width: 10%;Â Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;Â Â 
Â  Â  Â  Â  Â  Â  background-color: #000 !important;Â Â 
Â  Â  Â  Â  Â  Â  color: #fff !important;Â Â 
Â  Â  Â  Â  }Â Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  .action-col { width: 25%; text-align: center; white-space: nowrap; }Â 
Â 
Â  Â  Â  Â  tr:nth-child(even) { background-color: #f8f9fa; }Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  .tbl-btn { padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem; margin: 0 2px; }Â 
Â  Â  Â  Â  .tbl-btn.edit { background-color: #ffc107; color: #000; }Â 
Â  Â  Â  Â  .tbl-btn.del { background-color: #dc3545; color: #fff; }Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  .editable-code { color: #007bff; cursor: pointer; text-decoration: underline; font-weight: bold; }Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  /* Modal */Â 
Â  Â  Â  Â  .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; justify-content: center; align-items: center; }Â 
Â  Â  Â  Â  .modal-content { background: #333; padding: 20px; border-radius: 8px; width: 90%; max-width: 400px; border: 1px solid #555; max-height: 80vh; overflow-y: auto; }Â 
Â  Â  Â  Â  .modal h3 { text-align: center; color: #17a2b8; margin-bottom: 15px; }Â 
Â  Â  Â  Â  .setting-group { margin-bottom: 15px; }Â 
Â  Â  Â  Â  .setting-group label { display: block; margin-bottom: 5px; color: #ccc; font-size: 0.9rem; }Â 
Â  Â  Â  Â  .setting-group input, .setting-group select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #555; background: #222; color: white; }Â 
Â  Â  Â  Â  .modal-actions { display: flex; gap: 10px; margin-top: 20px; }Â 
Â 
Â  Â  Â  Â  /* å”¯è®€è¼¸å…¥æ¡†æ¨£å¼ */Â 
Â  Â  Â  Â  .input-readonly {Â 
Â  Â  Â  Â  Â  Â  background-color: #444 !important;Â 
Â  Â  Â  Â  Â  Â  color: #aaa !important;Â 
Â  Â  Â  Â  Â  Â  border: none !important;Â 
Â  Â  Â  Â  Â  Â  cursor: not-allowed;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.8rem;Â 
Â  Â  Â  Â  }Â 
Â  Â  </style>Â 
</head>Â 
<body>Â 
Â 
Â  Â  <h2>CL / CT _ Inventory</h2>Â 
Â 
Â  Â  <div class="user-bar">Â 
Â  Â  Â  Â  <label>ğŸ‘¤ äººå“¡ä»£è™Ÿ (User):</label>Â 
Â  Â  Â  Â  <input type="text" id="userInput" class="input-field" placeholder="è«‹å…ˆè¼¸å…¥ä»£è™Ÿ" onchange="changeUser(this.value)">Â 
Â  Â  </div>Â 
Â 
Â  Â  <div class="mode-switch">Â 
Â  Â  Â  Â  <button class="mode-btn active" onclick="switchMode('barcode')">Â 
Â  Â  Â  Â  Â  Â  æ¢ç¢¼/QR<small>Barcode & QR</small>Â 
Â  Â  Â  Â  </button>Â 
Â  Â  Â  Â  <button class="mode-btn" onclick="switchMode('ocr')">Â 
Â  Â  Â  Â  Â  Â  æ–‡å­—è­˜åˆ¥<small>OCR Text</small>Â 
Â  Â  Â  Â  </button>Â 
Â  Â  </div>Â 
Â 
Â  Â  <div class="viewport" onclick="handleViewportClick()">Â 
Â  Â  Â  Â  <div id="reader"></div>Â 
Â  Â  Â  Â  <video id="ocr-video" autoplay playsinline></video>Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  <div id="ocr-overlay" class="scan-guide-overlay">Â 
Â  Â  Â  Â  Â  Â  <div class="guide-box" id="guideBox">Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="guide-line"></div>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="guide-text" id="guideText">ğŸ‘† é»æ“Šç•«é¢å•Ÿå‹•ç›¸æ©Ÿ</div>Â 
Â  Â  Â  Â  Â  Â  </div>Â 
Â  Â  Â  Â  </div>Â 
Â 
Â  Â  Â  Â  <div id="loading-overlay">Â 
Â  Â  Â  Â  Â  Â  <div class="spinner"></div>Â 
Â  Â  Â  Â  Â  Â  <div style="color:white; font-weight:bold;" id="loading-text">åˆ†æä¸­...</div>Â 
Â  Â  Â  Â  </div>Â 
Â  Â  </div>Â 
Â 
Â  Â  <div class="controls">Â 
Â  Â  Â  Â  <button class="btn-clear action-btn" onclick="clearData()">Â 
Â  Â  Â  Â  Â  Â  ğŸ—‘ï¸ æ¸…é™¤<small>Clear</small>Â 
Â  Â  Â  Â  </button>Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  <button id="btn-flash" class="btn-flash action-btn" onclick="toggleTorch()">Â 
Â  Â  Â  Â  Â  Â  ğŸ”¦ è£œå…‰<small>Light</small>Â 
Â  Â  Â  Â  </button>Â 
Â  Â  Â  Â  Â 
Â  Â  Â  Â  <button class="btn-settings action-btn" onclick="openSettings()">Â 
Â  Â  Â  Â  Â  Â  âš™ï¸ è¨­å®š<small>Settings</small>Â 
Â  Â  Â  Â  </button>Â 
Â 
Â  Â  Â  Â  <button class="btn-export action-btn" onclick="exportToExcel()">Â 
Â  Â  Â  Â  Â  Â  ğŸ“¤ åŒ¯å‡º<small>Export</small>Â 
Â  Â  Â  Â  </button>Â 
Â 
Â  Â  Â  Â  <button class="btn-upload action-btn" onclick="uploadToCloud()">Â 
Â  Â  Â  Â  Â  Â  â˜ï¸ ä¸Šå‚³<small>Cloud</small>Â 
Â  Â  Â  Â  </button>Â 
Â 
Â  Â  Â  Â  <button class="btn-sheet action-btn" onclick="openCloudSheet()">Â 
Â  Â  Â  Â  Â  Â  ğŸ“‚ é›²ç«¯<small>Sheet</small>Â 
Â  Â  Â  Â  </button>Â 
Â  Â  </div>Â 
Â 
Â  Â  <div class="table-container">Â 
Â  Â  Â  Â  <table id="inventoryTable">Â 
Â  Â  Â  Â  Â  Â  <thead>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <tr>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="code-col">åŸå§‹ç¢¼ (Code)</th>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="loc-col">åº«ä½ (Loc)</th>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="name-col">å“å (Name)</th>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="qty-col">æ•¸é‡ (Qty)</th>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="action-col">æ“ä½œ</th>Â 
Â  Â  Â  Â  Â  Â  Â  Â  </tr>Â 
Â  Â  Â  Â  Â  Â  </thead>Â 
Â  Â  Â  Â  Â  Â  <tbody></tbody>Â 
Â  Â  Â  Â  </table>Â 
Â  Â  </div>Â 
Â 
Â  Â  <div id="settingsModal" class="modal">Â 
Â  Â  Â  Â  <div class="modal-content">Â 
Â  Â  Â  Â  Â  Â  <h3>âš™ï¸ ç³»çµ±è¨­å®š</h3>Â 
Â  Â  Â  Â  Â  Â  <div class="setting-group">Â 
Â  Â  Â  Â  Â  Â  Â  Â  <label>å°æ•¸é»ä½æ•¸ (0-4):</label>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <select id="set_decimals"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select>Â 
Â  Â  Â  Â  Â  Â  </div>Â 
Â  Â  Â  Â  Â  Â  <div class="setting-group"><label>æœ€å°‘è¾¨è­˜å­—å…ƒ (Min):</label><input type="number" id="set_minLen" value="4"></div>Â 
Â  Â  Â  Â  Â  Â  <div class="setting-group"><label>æœ€å¤šè¾¨è­˜å­—å…ƒ (Max):</label><input type="number" id="set_maxLen" value="50"></div>Â 
Â  Â  Â  Â  Â  Â  <div class="setting-group">Â 
Â  Â  Â  Â  Â  Â  Â  Â  <label>åŒ¯å‡ºæª”åæ ¼å¼:</label>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="set_filename" value="USER_YYYYMMDDHHmmss">Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:0.7rem; color:#aaa; margin-top:3px;">å¯ç”¨: USER, YYYY, MM, DD, HH, mm, ss</div>Â 
Â  Â  Â  Â  Â  Â  </div>Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  <div class="setting-group">Â 
Â  Â  Â  Â  Â  Â  Â  Â  <label style="color:#007bff">â˜ï¸ Google Script ç¶²å€ (ä¸Šå‚³ç”¨ - å”¯è®€):</label>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="display_cloudUrl" class="input-readonly" readonly disabled>Â 
Â  Â  Â  Â  Â  Â  </div>Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  <div class="setting-group">Â 
Â  Â  Â  Â  Â  Â  Â  Â  <label style="color:#6610f2">ğŸ“Š Google è©¦ç®—è¡¨ç¶²å€ (æª¢è¦–ç”¨ - å”¯è®€):</label>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="display_sheetUrl" class="input-readonly" readonly disabled>Â 
Â  Â  Â  Â  Â  Â  </div>Â 
Â 
Â  Â  Â  Â  Â  Â  <div class="modal-actions">Â 
Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn" style="background:#6c757d" onclick="closeSettings()">å–æ¶ˆ</button>Â 
Â  Â  Â  Â  Â  Â  Â  Â  <button class="action-btn" style="background:#28a745" onclick="saveSettings()">å„²å­˜</button>Â 
Â  Â  Â  Â  Â  Â  </div>Â 
Â  Â  Â  Â  </div>Â 
Â  Â  </div>Â 
Â 
Â  Â  <script>Â 
Â  Â  Â  Â  // ==========================================Â 
Â  Â  Â  Â  // ğŸ”§ æ ¸å¿ƒè¨­å®šå€ (System Config) - ç¶²å€å¯«æ­»åœ¨æ­¤è™•Â 
Â  Â  Â  Â  // ==========================================Â 
Â  Â  Â  Â  const SYSTEM_CONFIG = {Â 
Â  Â  Â  Â  Â  Â  // Google Script ç¶²å€ (ä¸Šå‚³ç”¨)Â 
Â  Â  Â  Â  Â  Â  API_URL: "https://script.google.com/macros/s/AKfycbxIVUaAXpAWdEvnKiARhOFExB57PXgBANt9iEG6AdwcGT3H_PE1A8fTN8JgH-Dr1nXS4Q/exec",Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  // Google è©¦ç®—è¡¨ç¶²å€ (æª¢è¦–ç”¨)Â 
Â  Â  Â  Â  Â  Â  SHEET_URL: "https://docs.google.com/spreadsheets/d/1T4tveDcNoiYCjDr6BABeKPfRBlWPUGl_8PRpPrwuiE8/edit?gid=0#gid=0"Â 
Â  Â  Â  Â  };Â 
Â  Â  Â  Â  // ==========================================Â 
Â 
Â  Â  Â  Â  let savedUser = localStorage.getItem('currentUser') || "Default";Â Â 
Â  Â  Â  Â  document.getElementById('userInput').value = savedUser;Â 
Â  Â  Â  Â  let inventory = {};Â Â 
Â  Â  Â  Â  let lastLocation = localStorage.getItem('lastLocation') || "";Â 
Â 
Â  Â  Â  Â  // è®€å–ä¸€èˆ¬ä½¿ç”¨è€…è¨­å®šÂ 
Â  Â  Â  Â  let appSettings = JSON.parse(localStorage.getItem('appSettings')) || {};Â 
Â 
Â  Â  Â  Â  if (appSettings.decimals === undefined) appSettings.decimals = 2;Â 
Â  Â  Â  Â  if (appSettings.minLen === undefined) appSettings.minLen = 4;Â 
Â  Â  Â  Â  if (appSettings.maxLen === undefined) appSettings.maxLen = 50;Â 
Â  Â  Â  Â  if (!appSettings.filenameFormat) appSettings.filenameFormat = "USER_YYYYMMDDHHmmss";Â 
Â 
Â  Â  Â  Â  localStorage.setItem('appSettings', JSON.stringify(appSettings));Â 
Â 
Â  Â  Â  Â  let html5QrcodeScanner = null;Â 
Â  Â  Â  Â  let ocrStream = null;Â 
Â  Â  Â  Â  let ocrAnalysisInterval = null;Â 
Â  Â  Â  Â  let currentMode = 'barcode';Â Â 
Â  Â  Â  Â  let videoTrack = null;Â Â 
Â  Â  Â  Â  let isTorchOn = false;Â 
Â  Â  Â  Â  let isScanning = false;Â Â 
Â  Â  Â  Â  let isCameraActive = false;Â 
Â 
Â  Â  Â  Â  loadInventoryForUser(savedUser);Â 
Â 
Â  Â  Â  Â  function changeUser(val) {Â 
Â  Â  Â  Â  Â  Â  val = val.trim();Â 
Â  Â  Â  Â  Â  Â  if (!val) val = "Default";Â 
Â  Â  Â  Â  Â  Â  savedUser = val;Â 
Â  Â  Â  Â  Â  Â  localStorage.setItem('currentUser', savedUser);Â 
Â  Â  Â  Â  Â  Â  loadInventoryForUser(savedUser);Â 
Â  Â  Â  Â  Â  Â  alert(`ğŸ‘‹ å·²åˆ‡æ›è‡³ä½¿ç”¨è€…: ${savedUser}`);Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function loadInventoryForUser(userId) {Â 
Â  Â  Â  Â  Â  Â  let key = `inventory_${userId}`;Â Â 
Â  Â  Â  Â  Â  Â  inventory = JSON.parse(localStorage.getItem(key)) || {};Â 
Â  Â  Â  Â  Â  Â  renderTable();Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function saveCurrentInventory() {Â 
Â  Â  Â  Â  Â  Â  let key = `inventory_${savedUser}`;Â 
Â  Â  Â  Â  Â  Â  localStorage.setItem(key, JSON.stringify(inventory));Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function openSettings() {Â 
Â  Â  Â  Â  Â  Â  // è®€å–è¨­å®šÂ 
Â  Â  Â  Â  Â  Â  appSettings = JSON.parse(localStorage.getItem('appSettings')) || {};Â 
Â 
Â  Â  Â  Â  Â  Â  document.getElementById('set_decimals').value = appSettings.decimals;Â 
Â  Â  Â  Â  Â  Â  document.getElementById('set_minLen').value = appSettings.minLen;Â 
Â  Â  Â  Â  Â  Â  document.getElementById('set_maxLen').value = appSettings.maxLen;Â 
Â  Â  Â  Â  Â  Â  document.getElementById('set_filename').value = appSettings.filenameFormat;Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  // é¡¯ç¤ºå¯«æ­»çš„ç¶²å€ (åƒ…ä¾›æŸ¥çœ‹ï¼Œä¸å¯ä¿®æ”¹)Â 
Â  Â  Â  Â  Â  Â  document.getElementById('display_cloudUrl').value = SYSTEM_CONFIG.API_URL;Â 
Â  Â  Â  Â  Â  Â  document.getElementById('display_sheetUrl').value = SYSTEM_CONFIG.SHEET_URL;Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  document.getElementById('settingsModal').style.display = 'flex';Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }Â 
Â 
Â  Â  Â  Â  function saveSettings() {Â 
Â  Â  Â  Â  Â  Â  appSettings.decimals = parseInt(document.getElementById('set_decimals').value);Â 
Â  Â  Â  Â  Â  Â  appSettings.minLen = parseInt(document.getElementById('set_minLen').value);Â 
Â  Â  Â  Â  Â  Â  appSettings.maxLen = parseInt(document.getElementById('set_maxLen').value);Â 
Â  Â  Â  Â  Â  Â  appSettings.filenameFormat = document.getElementById('set_filename').value.trim();Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  // æ³¨æ„ï¼šæˆ‘å€‘ä¸éœ€è¦å„²å­˜ç¶²å€ï¼Œå› ç‚ºå·²ç¶“å¯«æ­»åœ¨ç¨‹å¼ç¢¼ä¸­Â 
Â 
Â  Â  Â  Â  Â  Â  localStorage.setItem('appSettings', JSON.stringify(appSettings));Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  closeSettings();Â 
Â  Â  Â  Â  Â  Â  renderTable();Â 
Â  Â  Â  Â  Â  Â  alert("âœ… è¨­å®šå·²å„²å­˜");Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function openCloudSheet() {Â 
Â  Â  Â  Â  Â  Â  // ç›´æ¥é–‹å•Ÿå¯«æ­»çš„ç¶²å€Â 
Â  Â  Â  Â  Â  Â  window.open(SYSTEM_CONFIG.SHEET_URL, '_blank');Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function switchMode(mode) {Â 
Â  Â  Â  Â  Â  Â  currentMode = mode;Â 
Â  Â  Â  Â  Â  Â  document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));Â 
Â  Â  Â  Â  Â  Â  document.querySelector(`.mode-btn[onclick="switchMode('${mode}')"]`).classList.add('active');Â 
Â 
Â  Â  Â  Â  Â  Â  const readerEl = document.getElementById('reader');Â 
Â  Â  Â  Â  Â  Â  const videoEl = document.getElementById('ocr-video');Â 
Â  Â  Â  Â  Â  Â  const overlayEl = document.getElementById('ocr-overlay');Â 
Â  Â  Â  Â  Â  Â  const flashBtn = document.getElementById('btn-flash');Â 
Â 
Â  Â  Â  Â  Â  Â  stopOcrCamera();Â 
Â  Â  Â  Â  Â  Â  stopBarcodeScanner().then(() => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (mode === 'barcode') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  videoEl.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlayEl.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readerEl.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashBtn.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startBarcodeScanner();Â 
Â  Â  Â  Â  Â  Â  Â  Â  } else {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  readerEl.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  videoEl.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  overlayEl.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  startOcrCamera().then(() => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (videoTrack && videoTrack.getCapabilities().torch) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flashBtn.style.display = 'flex';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  isCameraActive = true;Â 
Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function handleViewportClick() {Â 
Â  Â  Â  Â  Â  Â  if (!isCameraActive) { switchMode(currentMode); return; }Â 
Â  Â  Â  Â  Â  Â  if (currentMode === 'ocr') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (isScanning) { captureAndProcess(); }Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  else { resumeScanning(); }Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function stopScanning() {Â 
Â  Â  Â  Â  Â  Â  isScanning = false;Â 
Â  Â  Â  Â  Â  Â  const video = document.getElementById('ocr-video');Â 
Â  Â  Â  Â  Â  Â  video.pause();Â Â 
Â  Â  Â  Â  Â  Â  clearInterval(ocrAnalysisInterval);Â Â 
Â  Â  Â  Â  Â  Â  const box = document.getElementById('guideBox');Â 
Â  Â  Â  Â  Â  Â  const text = document.getElementById('guideText');Â 
Â  Â  Â  Â  Â  Â  box.classList.add('paused');Â 
Â  Â  Â  Â  Â  Â  box.classList.remove('ready');Â 
Â  Â  Â  Â  Â  Â  text.innerText = "ğŸ‘† é»æ“Šç•«é¢ç¹¼çºŒåµæ¸¬ Tap to Resume";Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function resumeScanning() {Â 
Â  Â  Â  Â  Â  Â  isScanning = true;Â 
Â  Â  Â  Â  Â  Â  const video = document.getElementById('ocr-video');Â 
Â  Â  Â  Â  Â  Â  video.play();Â Â 
Â  Â  Â  Â  Â  Â  startImageAnalysis(video);Â Â 
Â  Â  Â  Â  Â  Â  const box = document.getElementById('guideBox');Â 
Â  Â  Â  Â  Â  Â  const text = document.getElementById('guideText');Â 
Â  Â  Â  Â  Â  Â  box.classList.remove('paused');Â 
Â  Â  Â  Â  Â  Â  text.innerText = "è«‹ä»¥ä¸­å¿ƒç·šè¦†è“‹æ–‡å­—";Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  let html5QrCode = null;Â Â 
Â  Â  Â  Â  function startBarcodeScanner() {Â 
Â  Â  Â  Â  Â  Â  if (!html5QrCode) { html5QrCode = new Html5Qrcode("reader"); }Â 
Â  Â  Â  Â  Â  Â  const config = { fps: 10, qrbox: { width: 250, height: 250 } };Â 
Â  Â  Â  Â  Â  Â  html5QrCode.start({ facingMode: "environment" }, config, (decodedText) => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  html5QrCode.pause();Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  saveDataPrompt(decodedText);Â Â 
Â  Â  Â  Â  Â  Â  }, () => {}).catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  if (err.toString().includes("NotAllowed") || err.toString().includes("Permission")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("âŒ ç„¡æ³•å­˜å–ç›¸æ©Ÿï¼Œè«‹è‡³è¨­å®šé–‹å•Ÿæ¬Šé™\n(Camera access denied. Please enable permission in settings.)");
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Barcode Start Error: " + err);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function stopBarcodeScanner() {Â 
Â  Â  Â  Â  Â  Â  if (html5QrCode && html5QrCode.isScanning) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  return html5QrCode.stop().catch(err => console.log("Stop failed", err));Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  return Promise.resolve();Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function resumeBarcodeScanner() { if (html5QrCode) html5QrCode.resume(); }Â 
Â 
Â  Â  Â  Â  async function startOcrCamera() {Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const constraints = { video: { facingMode: "environment", width: { ideal: 3840 }, height: { ideal: 2160 }, focusMode: "continuous" } };Â 
Â  Â  Â  Â  Â  Â  Â  Â  ocrStream = await navigator.mediaDevices.getUserMedia(constraints);Â 
Â  Â  Â  Â  Â  Â  Â  Â  const video = document.getElementById('ocr-video');Â 
Â  Â  Â  Â  Â  Â  Â  Â  video.srcObject = ocrStream;Â 
Â  Â  Â  Â  Â  Â  Â  Â  videoTrack = ocrStream.getVideoTracks()[0];Â 
Â  Â  Â  Â  Â  Â  Â  Â  isScanning = true;Â 
Â  Â  Â  Â  Â  Â  Â  Â  startImageAnalysis(video);Â 
Â  Â  Â  Â  Â  Â  } catch (err) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError' || err.toString().includes("Permission")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("âŒ ç„¡æ³•å­˜å–ç›¸æ©Ÿï¼Œè«‹è‡³è¨­å®šé–‹å•Ÿæ¬Šé™\n(Camera access denied. Please enable permission in settings.)");
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("Camera Error: " + err);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function stopOcrCamera() {Â 
Â  Â  Â  Â  Â  Â  if (ocrStream) { ocrStream.getTracks().forEach(track => track.stop()); ocrStream = null; }Â 
Â  Â  Â  Â  Â  Â  if (ocrAnalysisInterval) { clearInterval(ocrAnalysisInterval); ocrAnalysisInterval = null; }Â 
Â  Â  Â  Â  Â  Â  videoTrack = null;Â 
Â  Â  Â  Â  Â  Â  isTorchOn = false;Â 
Â  Â  Â  Â  Â  Â  document.getElementById('btn-flash').classList.remove('active');Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function toggleTorch() {Â 
Â  Â  Â  Â  Â  Â  if (!videoTrack) return;Â 
Â  Â  Â  Â  Â  Â  isTorchOn = !isTorchOn;Â 
Â  Â  Â  Â  Â  Â  videoTrack.applyConstraints({ advanced: [{ torch: isTorchOn }] }).catch(e => { isTorchOn = !isTorchOn; });Â 
Â  Â  Â  Â  Â  Â  const btn = document.getElementById('btn-flash');Â 
Â  Â  Â  Â  Â  Â  if(isTorchOn) { btn.style.backgroundColor = "#fff"; btn.style.color = "#000"; }Â Â 
Â  Â  Â  Â  Â  Â  else { btn.style.backgroundColor = "#ffc107"; btn.style.color = "#333"; }Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function startImageAnalysis(video) {Â 
Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');Â 
Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d', { willReadFrequently: true });Â 
Â  Â  Â  Â  Â  Â  if (ocrAnalysisInterval) clearInterval(ocrAnalysisInterval);Â 
Â  Â  Â  Â  Â  Â  ocrAnalysisInterval = setInterval(() => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (video.readyState === 4 && isScanning) {Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.width = video.videoWidth;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  canvas.height = video.videoHeight;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cropHeight = canvas.height * 0.045;Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const cropY = (canvas.height - cropHeight) / 2;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ctx.drawImage(video, 0, 0);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const imgData = ctx.getImageData(0, cropY, canvas.width, cropHeight);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const score = calculateContrast(imgData.data);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  updateGuideUI(score > 30);Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  }, 200);Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function calculateContrast(data) {Â 
Â  Â  Â  Â  Â  Â  let sum = 0, count = 0;Â 
Â  Â  Â  Â  Â  Â  for (let i = 0; i < data.length; i += 80) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  sum += (data[i] * 0.299 + data[i+1] * 0.587 + data[i+2] * 0.114); count++;Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  const mean = sum / count;Â 
Â  Â  Â  Â  Â  Â  let variance = 0;Â 
Â  Â  Â  Â  Â  Â  for (let i = 0; i < data.length; i += 80) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  const gray = (data[i] * 0.299 + data[i+1] * 0.587 + data[i+2] * 0.114);Â 
Â  Â  Â  Â  Â  Â  Â  Â  variance += Math.pow(gray - mean, 2);Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  return Math.sqrt(variance / count);Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function updateGuideUI(isGoodQuality) {Â 
Â  Â  Â  Â  Â  Â  const box = document.getElementById('guideBox');Â 
Â  Â  Â  Â  Â  Â  const text = document.getElementById('guideText');Â 
Â  Â  Â  Â  Â  Â  if (!isScanning) return;Â Â 
Â  Â  Â  Â  Â  Â  if (isGoodQuality) { box.classList.add('ready'); text.innerText = "âœ… Ready / Tap Screen"; }Â Â 
Â  Â  Â  Â  Â  Â  else { box.classList.remove('ready'); text.innerText = "è«‹ä»¥ä¸­å¿ƒç·šè¦†è“‹æ–‡å­—"; }Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function captureAndProcess() {Â 
Â  Â  Â  Â  Â  Â  const video = document.getElementById('ocr-video');Â 
Â  Â  Â  Â  Â  Â  if (currentMode !== 'ocr' || video.style.display === 'none') return;Â 
Â 
Â  Â  Â  Â  Â  Â  video.pause();Â 
Â  Â  Â  Â  Â  Â  stopScanning();Â Â 
Â 
Â  Â  Â  Â  Â  Â  const canvas = document.createElement('canvas');Â 
Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');Â 
Â  Â  Â  Â  Â  Â  canvas.width = video.videoWidth;Â 
Â  Â  Â  Â  Â  Â  canvas.height = video.videoHeight;Â 
Â  Â  Â  Â  Â  Â  ctx.drawImage(video, 0, 0);Â 
Â 
Â  Â  Â  Â  Â  Â  const cropHeight = canvas.height * 0.045;Â Â 
Â  Â  Â  Â  Â  Â  const cropY = (canvas.height - cropHeight) / 2;Â 
Â 
Â  Â  Â  Â  Â  Â  const cropCanvas = document.createElement('canvas');Â 
Â  Â  Â  Â  Â  Â  cropCanvas.width = canvas.width;Â 
Â  Â  Â  Â  Â  Â  cropCanvas.height = cropHeight;Â 
Â  Â  Â  Â  Â  Â  const cropCtx = cropCanvas.getContext('2d');Â 
Â  Â  Â  Â  Â  Â  cropCtx.drawImage(canvas, 0, cropY, canvas.width, cropHeight, 0, 0, cropCanvas.width, cropCanvas.height);Â 
Â 
Â  Â  Â  Â  Â  Â  document.getElementById('loading-overlay').style.display = 'flex';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('loading-text').innerText = "åˆ†æä¸­... Analyzing...";Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Tesseract.recognize(Â 
Â  Â  Â  Â  Â  Â  Â  Â  cropCanvas.toDataURL('image/jpeg'),Â 
Â  Â  Â  Â  Â  Â  Â  Â  'eng',Â 
Â  Â  Â  Â  Â  Â  Â  Â  {Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tessedit_char_whitelist: 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789.-',Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tessedit_pageseg_mode: '7'Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  ).then(({ data: { text } }) => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-overlay').style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  processResult(text);Â 
Â  Â  Â  Â  Â  Â  }).catch(err => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-overlay').style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  alert("OCR Error: " + err);Â 
Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function processResult(text) {Â 
Â  Â  Â  Â  Â  Â  Â let cleanText = text.replace(/[^a-zA-Z0-9.-]/g, "");Â 
Â  Â  Â  Â  Â  Â  Â const strongPattern = /[A-Z0-9]+(-[A-Z0-9.]+){3,}/;Â 
Â  Â  Â  Â  Â  Â  Â const match = cleanText.match(strongPattern);Â 
Â  Â  Â  Â  Â  Â  Â if (match) { cleanText = match[0]; }Â Â 
Â  Â  Â  Â  Â  Â  Â cleanText = cleanText.replace(/^[-.]+|[-.]+$/g, "");Â 
Â 
Â  Â  Â  Â  Â  Â  if (!cleanText) { alert("âš ï¸ æœªåµæ¸¬åˆ°æ–‡å­—ï¼Œè«‹é‡è©¦"); return; }Â 
Â 
Â  Â  Â  Â  Â  Â  saveDataPrompt(cleanText);Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function renderTable() {Â 
Â  Â  Â  Â  Â  Â  const tbody = document.querySelector("#inventoryTable tbody");Â 
Â  Â  Â  Â  Â  Â  tbody.innerHTML = "";Â 
Â  Â  Â  Â  Â  Â  Object.keys(inventory).reverse().forEach(k => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  let item = inventory[k];Â 
Â  Â  Â  Â  Â  Â  Â  Â  let qtyDisplay = parseFloat(item.qty).toFixed(appSettings.decimals);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  tbody.innerHTML += `Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="code-col">Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="editable-code" onclick="saveDataPrompt('${k}')">${k}</span>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span style="font-size:0.7em; color:#999;">(${k.length})</span>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="loc-col" style="color:#ffc107;">${item.location || '-'}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="name-col">${item.name}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="qty-col">${qtyDisplay}</td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="action-col">Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="tbl-btn edit" onclick="saveDataPrompt('${k}')">âœï¸</button>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="tbl-btn del" onclick="deleteItem('${k}')">ğŸ—‘ï¸</button>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>`;Â 
Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function deleteItem(code) {Â 
Â  Â  Â  Â  Â  Â  if(confirm(`ç¢ºå®šåˆªé™¤ ${code} ?`)) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  delete inventory[code];Â 
Â  Â  Â  Â  Â  Â  Â  Â  saveCurrentInventory();Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderTable();Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function saveDataPrompt(initialText) {Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  let code = prompt("1ï¸âƒ£ ç¢ºèªåŸå§‹ç¢¼ (Code):", initialText);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (code === null) return resumeScan();Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  code = code.replace(/[^a-zA-Z0-9.-]/g, "").trim();Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!code) return resumeScan();Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (code.length < appSettings.minLen) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert(`âŒ å­—å…ƒéçŸ­ (<${appSettings.minLen})`);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return resumeScan();Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  let item = inventory[code];Â 
Â  Â  Â  Â  Â  Â  Â  Â  let defaultName = item ? item.name : (code.split('-')[0] || "");Â 
Â  Â  Â  Â  Â  Â  Â  Â  let defaultQty = item ? item.qty.toString() : "";Â 
Â  Â  Â  Â  Â  Â  Â  Â  let defaultLoc = item ? item.location : lastLocation;Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  let name = prompt(`2ï¸âƒ£ è¼¸å…¥å“å (Name):`, defaultName);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (name === null) return resumeScan();Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  let qtyStr = prompt(`3ï¸âƒ£ è¼¸å…¥æ•¸é‡ (Qty):`, defaultQty);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (qtyStr === null) return resumeScan();Â 
Â  Â  Â  Â  Â  Â  Â  Â  let qty = parseFloat(qtyStr);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (isNaN(qty)) qty = 1.00;Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  let location = prompt(`4ï¸âƒ£ è¼¸å…¥åº«ä½ (Location):`, defaultLoc);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (location === null) return resumeScan();Â 
Â  Â  Â  Â  Â  Â  Â  Â  location = location.trim();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (location) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastLocation = location;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localStorage.setItem('lastLocation', lastLocation);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  inventory[code] = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: name || "No Name",Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  qty: qty,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  location: locationÂ 
Â  Â  Â  Â  Â  Â  Â  Â  };Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  saveCurrentInventory();Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderTable();Â 
Â  Â  Â  Â  Â  Â  Â  Â  resumeScan();Â 
Â 
Â  Â  Â  Â  Â  Â  }, 100);Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function resumeScan() {Â 
Â  Â  Â  Â  Â  Â  Â if (currentMode === 'barcode') {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â resumeBarcodeScanner();Â 
Â  Â  Â  Â  Â  Â  Â }Â Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function uploadToCloud() {Â 
Â  Â  Â  Â  Â  Â  if (Object.keys(inventory).length === 0) return alert("âŒ ç„¡è³‡æ–™");Â 
Â  Â  Â  Â  Â  Â  if (!savedUser || savedUser === "Default") return alert("âš ï¸ è«‹è¼¸å…¥äººå“¡ä»£è™Ÿ");Â 
Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  // ç›´æ¥ä½¿ç”¨å¯«æ­»çš„ SYSTEM_CONFIG.API_URLÂ 
Â  Â  Â  Â  Â  Â  if(!confirm("ç¢ºå®šä¸Šå‚³è‡³é›²ç«¯?")) return;Â 
Â 
Â  Â  Â  Â  Â  Â  document.getElementById('loading-overlay').style.display = 'flex';Â 
Â  Â  Â  Â  Â  Â  document.getElementById('loading-text').innerText = "ä¸Šå‚³ä¸­... Uploading...";Â 
Â 
Â  Â  Â  Â  Â  Â  const payload = {Â 
Â  Â  Â  Â  Â  Â  Â  Â  user: savedUser,Â 
Â  Â  Â  Â  Â  Â  Â  Â  items: inventoryÂ 
Â  Â  Â  Â  Â  Â  };Â 
Â 
Â  Â  Â  Â  Â  Â  fetch(SYSTEM_CONFIG.API_URL, {Â 
Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',Â 
Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)Â 
Â  Â  Â  Â  Â  Â  })Â 
Â  Â  Â  Â  Â  Â  .then(response => response.text())Â 
Â  Â  Â  Â  Â  Â  .then(data => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-overlay').style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  alert("âœ… " + data);Â 
Â  Â  Â  Â  Â  Â  })Â 
Â  Â  Â  Â  Â  Â  .catch(error => {Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-overlay').style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  Â  Â  alert("âŒ ä¸Šå‚³å¤±æ•—: " + error);Â 
Â  Â  Â  Â  Â  Â  });Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function exportToExcel() {Â 
Â  Â  Â  Â  Â  Â  if (Object.keys(inventory).length === 0) { return alert("âŒ ç„¡è³‡æ–™ (No Data)"); }Â 
Â  Â  Â  Â  Â  Â  if (!savedUser || savedUser === "Default") { return alert("âš ï¸ è«‹å…ˆè¼¸å…¥äººå“¡ä»£è™Ÿï¼"); }Â 
Â 
Â  Â  Â  Â  Â  Â  alert("1. æº–å‚™åŒ¯å‡º... (Starting Export)");Â 
Â  Â  Â  Â  Â  Â  try {Â 
Â  Â  Â  Â  Â  Â  Â  Â  let csv = "\uFEFFCode,Spec,Location,Name,Qty\n";Â 
Â  Â  Â  Â  Â  Â  Â  Â  for (let k in inventory) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let safeName = (inventory[k].name || "").replace(/,/g, " ").replace(/"/g, "");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let loc = (inventory[k].location || "").replace(/,/g, " ");Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let parts = k.split('-');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let middleTxt = parts.length >= 3 ? parts[1] : "";Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let qtyFormatted = inventory[k].qty.toFixed(appSettings.decimals);Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  csv += '="' + k + '","' + middleTxt + '","' + loc + '","' + safeName + '",' + qtyFormatted + '\n';Â 
Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  let blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });Â 
Â  Â  Â  Â  Â  Â  Â  Â  let url = URL.createObjectURL(blob);Â 
Â  Â  Â  Â  Â  Â  Â  Â  let link = document.createElement("a");Â 
Â  Â  Â  Â  Â  Â  Â  Â  link.href = url;Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  const now = new Date();Â 
Â  Â  Â  Â  Â  Â  Â  Â  const YYYY = now.getFullYear();Â 
Â  Â  Â  Â  Â  Â  Â  Â  const MM = String(now.getMonth() + 1).padStart(2, '0');Â 
Â  Â  Â  Â  Â  Â  Â  Â  const DD = String(now.getDate()).padStart(2, '0');Â 
Â  Â  Â  Â  Â  Â  Â  Â  const HH = String(now.getHours()).padStart(2, '0');Â 
Â  Â  Â  Â  Â  Â  Â  Â  const mm = String(now.getMinutes()).padStart(2, '0');Â 
Â  Â  Â  Â  Â  Â  Â  Â  const ss = String(now.getSeconds()).padStart(2, '0');Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â  Â  Â  Â  Â  let filename = appSettings.filenameFormat;Â 
Â  Â  Â  Â  Â  Â  Â  Â  filename = filename.replace("USER", savedUser).replace("YYYY", YYYY).replace("MM", MM).replace("DD", DD).replace("HH", HH).replace("mm", mm).replace("ss", ss).replace("SS", ss);Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (!filename.endsWith(".csv")) filename += ".csv";Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  if(!confirm(`æº–å‚™åŒ¯å‡ºæª”æ¡ˆï¼š\nğŸ“„ ${filename}\n\næ˜¯å¦ç¹¼çºŒï¼Ÿ`)) return;Â 
Â 
Â  Â  Â  Â  Â  Â  Â  Â  link.download = filename;Â 
Â  Â  Â  Â  Â  Â  Â  Â  link.style.visibility = 'hidden';Â 
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(link);Â 
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(function() {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  link.click();Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(link);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  URL.revokeObjectURL(url);Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alert("âœ… åŒ¯å‡ºå®Œæˆ: " + fileName);Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, 100);Â 
Â  Â  Â  Â  Â  Â  } catch (err) { alert("åŒ¯å‡ºéŒ¯èª¤: " + err); }Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  function clearData() {Â 
Â  Â  Â  Â  Â  Â  if(confirm("ç¢ºå®šæ¸…é™¤æ‰€æœ‰è³‡æ–™ï¼Ÿ Clear All?")) {Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  inventory={};Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  saveCurrentInventory();Â 
Â  Â  Â  Â  Â  Â  Â  Â  renderTable();Â Â 
Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  }Â 
Â 
Â  Â  Â  Â  currentMode = 'ocr';Â 
Â  Â  Â  Â  document.querySelector('.mode-btn[onclick="switchMode(\'ocr\')"]').classList.add('active');Â 
Â  Â  Â  Â  document.querySelector('.mode-btn[onclick="switchMode(\'barcode\')"]').classList.remove('active');Â 
Â  Â  Â  Â  document.getElementById('guideText').innerText = "ğŸ‘† é»æ“Šç•«é¢å•Ÿå‹•ç›¸æ©Ÿ Tap to Start";Â 
Â  Â  Â  Â  renderTable();Â 
Â  Â  </script>Â 
</body>Â 
</html>
